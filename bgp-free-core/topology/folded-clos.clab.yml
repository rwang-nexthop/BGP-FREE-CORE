# Topology Name: folded-clos
# Description: A folded clos network topology with 6 SONiC nodes
#              - 4 leaf nodes (LRH-Q3D-0, LRH-Q3D-1, LRH-Q3D-2, LRH-Q3D-3)
#              - 2 spine nodes (URH-TH5-0, URH-TH5-1)
#              Each leaf is connected to both spines (full mesh)
#              VXLAN tunnels established between all leafs (0↔1, 1↔3, 3↔2, 2↔0)
#
name: folded-clos

mgmt:
  network: folded-clos-mgmt
  ipv4-subnet: 172.40.40.0/24

topology:
  kinds:
    sonic-vs:
      image: docker-sonic-vs:latest
    linux:
      image: wbitt/network-multitool:alpine-minimal

  nodes:
    # Leaf nodes (Level 0)
    LRH-Q3D-0:
      kind: sonic-vs
      type: ""

    LRH-Q3D-1:
      kind: sonic-vs
      type: ""

    LRH-Q3D-2:
      kind: sonic-vs
      type: ""

    LRH-Q3D-3:
      kind: sonic-vs
      type: ""

    # Spine nodes (Level 1)
    URH-TH5-0:
      kind: sonic-vs
      type: ""

    URH-TH5-1:
      kind: sonic-vs
      type: ""

  links:
    # Spine 0 connections to all leaves
    - endpoints: ["URH-TH5-0:eth1", "LRH-Q3D-0:eth1"]
    - endpoints: ["URH-TH5-0:eth2", "LRH-Q3D-1:eth1"]
    - endpoints: ["URH-TH5-0:eth3", "LRH-Q3D-2:eth1"]
    - endpoints: ["URH-TH5-0:eth4", "LRH-Q3D-3:eth1"]

    # Spine 1 connections to all leaves
    - endpoints: ["URH-TH5-1:eth1", "LRH-Q3D-0:eth2"]
    - endpoints: ["URH-TH5-1:eth2", "LRH-Q3D-1:eth2"]
    - endpoints: ["URH-TH5-1:eth3", "LRH-Q3D-2:eth2"]
    - endpoints: ["URH-TH5-1:eth4", "LRH-Q3D-3:eth2"]

    # VXLAN tunnel connections between leafs (for VXLAN testing)
    # Tunnels: 0↔1, 1↔3, 3↔2, 2↔0 (forming a ring)
    - endpoints: ["LRH-Q3D-0:eth3", "LRH-Q3D-1:eth3"]
    - endpoints: ["LRH-Q3D-1:eth4", "LRH-Q3D-3:eth4"]
    - endpoints: ["LRH-Q3D-3:eth3", "LRH-Q3D-2:eth3"]
    - endpoints: ["LRH-Q3D-2:eth4", "LRH-Q3D-0:eth4"]

